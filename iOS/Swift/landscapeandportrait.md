# 横竖屏切换的一些思考
最近在优化负责产品中的横竖屏切换功能，这部分是最开始接手这个产品时的第一个功能，过去了一年多了，有很多架构上不完整的地方，其中最忍受不了的是在 `Notification` 中使用中文作为 `value`。下文将详细的描述了重构该功能时所做的工作。

## 需求来源
横竖屏在一些视频类、游戏类等 app 中非常常见，目前来看横竖屏的展现方式有以下两种：

* 在用户打开“系统转屏”的前提下，提供手动切换横竖屏的能力，例如微信公众号文章；
* 不管用户是否打开“系统转屏”的功能，强制且被动的切换横竖屏，例如视频类 app 的全屏播放。

其实总的来看区别就在于是“主动”还是“被动”的触发，一般来说，在一个 app 中不会同时出现这两种情况，但我所负责的产品中同时出现了这两种场景，所需要做的工作自然也就多了一点。

## 最开始的做法
当时接手时开发这个功能时，我是和另外一个实习生一块搭伙做的。我正式入职时，他已经做了一个星期了，所以在架构上我没有投入多大的精力，只是一直在配合他。在配合的过程中确实是出现了很多问题，比如文章开头中所说的使用中文作为 Notification 的 `value` 等。

最开始的做法简单来说是这样的。在 Xcode 中支持 `Portrait` 和 `LandScape Right`（只需要一个横屏方向），监听 `UIApplicationDidChangeStatusBarFrame` 通知，在接收通知的方法中更新所有相关视图的 `frame`。也就是说，没有使用从 iOS 8 就已经引入的 `size-class` 特性进行设备的横竖屏适配，没有利用 `autoLayout` 而是使用了手写 `frame` 生算坐标横屏和竖屏各一套 `frame`。

问题当然很严重，当我发现这么干下去真的不行时，已经快到发版的时间了......于是，日后的好几个版本都延续了这种做法

## 经过了一段时间
经过一段时间后，那位实习生已经撤了，我开始着手一边跟进需求一边重构代码。在跟进需求时，PM 说出了让我十分震惊的一件事——**并不是所有的页面都需要做横竖屏！！！**

这也就是说，当初花了将近两个多星期的时间把所有页面适配的横竖屏布局代码付出的精力是...是完全没必要的！